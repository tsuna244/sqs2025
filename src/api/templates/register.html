{% extends "base.html" %}

{% block scripts %} 

<script>

  function send_registration() {
    var username =  document.loginform.username.value;
    var password = document.loginform.password.value;
    var repeat_passwd = document.loginform.password_repeat.value;
    var fail = false;
    if (!validatePassword(password) || !validateRepeat(repeat_passwd)) {
      fail = true;
      // popup wrong passwd
    }
    let regExp = /[a-z]/i;
    if (!regExp.test(username.charAt(0))) {
      fail = true;
      // popup wrong username
    }
    
  }

  function validateRepeat(repeat_passwd) {
    passwd = document.getElementById("password").value;
    check = repeat_passwd === passwd;
    err_message = document.getElementById("repeatMessage");
    if (check) {
      err_message.textContent = 'Same password';
      err_message.classList.remove("text-danger");
      err_message.classList.add("text-success");
    }else {
      err_message.textContent = 'Does not equal password';
      err_message.classList.remove("text-success");
      err_message.classList.add("text-danger");
    }
    return check;
  }

  function validatePassword(password) {
    const elem_len = document.getElementById("length");
    const elem_upper = document.getElementById("capital");
    const elem_digit = document.getElementById("number");
    const elem_lower = document.getElementById("letter");

    var fail = false;

    if (password.length >= 8) {
      elem_len.classList.remove("bi-x-lg");
      elem_len.classList.add("bi-check-lg");
      elem_len.classList.add("text-success");
      elem_len.classList.remove("text-danger");
    }else {
      fail = true;
      elem_len.classList.add("bi-x-lg");
      elem_len.classList.remove("bi-check-lg");
      elem_len.classList.remove("text-success");
      elem_len.classList.add("text-danger");
    }

    if (/[A-Z]/.test(password)) {
      elem_upper.classList.remove("bi-x-lg");
      elem_upper.classList.add("bi-check-lg");
      elem_upper.classList.add("text-success");
      elem_upper.classList.remove("text-danger");
    }else {
      fail = true;
      elem_upper.classList.add("bi-x-lg");
      elem_upper.classList.remove("bi-check-lg");
      elem_upper.classList.remove("text-success");
      elem_upper.classList.add("text-danger");
    }

    if (/[a-z]/.test(password)) {
      elem_lower.classList.remove("bi-x-lg");
      elem_lower.classList.add("bi-check-lg");
      elem_lower.classList.add("text-success");
      elem_lower.classList.remove("text-danger");
    }else {
      fail = true;
      elem_lower.classList.add("bi-x-lg");
      elem_lower.classList.remove("bi-check-lg");
      elem_lower.classList.remove("text-success");
      elem_lower.classList.add("text-danger");
    }

    if (/[0-9]/.test(password)) {
      elem_digit.classList.remove("bi-x-lg");
      elem_digit.classList.add("bi-check-lg");
      elem_digit.classList.add("text-success");
      elem_digit.classList.remove("text-danger");
    }else {
      fail = true;
      elem_digit.classList.add("bi-x-lg");
      elem_digit.classList.remove("bi-check-lg");
      elem_digit.classList.remove("text-success");
      elem_digit.classList.add("text-danger");
    }
  
    const errorMessage = document.getElementById('errorMessage');

    if (fail == true) {
      errorMessage.textContent = 'Weak Password';
      errorMessage.classList.remove('text-success');
      errorMessage.classList.add('text-danger');
    }else {
      errorMessage.textContent = 'Strong Password';
      errorMessage.classList.remove('text-danger');
      errorMessage.classList.add('text-success');
    }

    return !fail;

  }

</script>

{% endblock %}

{% block body %}

<link rel="stylesheet" href="{{ url_for('static', path='/form_style.css') }}">

<div class="container">

  <div class="row d-flex justify-content-center mt-5">
    <div class="col-12 col-md-8">
      <div class="card py-3 px-2">

        <div class="division">
					<div class="row">
						<div class="col-3"><div class="line l"></div></div>
						<div class="col-6"><span>Register with username and password</span></div>
						<div class="col-3"><div class="line r"></div></div>
					</div>
				</div>

        <form class="myform" name="loginform">
					<div class="form-group">
    				<input id="username" name="username" type="text" class="form-control" placeholder="Username">
            <span id="username_block">Your username must not be empty and start with a letter.</span>
  				</div>
 					<div class="form-group">
    				<input id="password" name="password" type="password" class="form-control" placeholder="Password" oninput="validatePassword(this.value)">
            <span id="errorMessage" class="font-weight-bold text-danger"></span>
          </div>
          <div class="form-group">
    				<input id="password_repeat" name="password_repeat" type="password" class="form-control" placeholder="Repeat password" oninput="validateRepeat(this.value)">
            <span id="repeatMessage" class="font-weight-bold text-danger"></span>
          </div>
  				<div class="form-group mt-3">
  					<button type="button" class="btn btn-block btn-outline-primary btn-lg" onclick="send_registration()"><small><i class="bi bi-person pr-2"></i>Register</small></button>
  				</div>
				</form>

        <div class="division" id="passwd_message">
          <h3>Password must contain the following:</h3>
          <p><i id="letter" class="bi bi-x-lg text-danger mr-1"></i>A <b>lowercase</b> letter</p>
          <p><i id="capital" class="bi bi-x-lg text-danger mr-1"></i>A <b>capital (uppercase)</b> letter</p>
          <p><i id="number" class="bi bi-x-lg text-danger mr-2"></i>A <b>number</b></p>
          <p><i id="length" class="bi bi-x-lg text-danger mr-2"></i>Minimum <b>8 characters</b></p>
        </div>

      </div>
    </div>
  </div>

</div>
{% endblock %}